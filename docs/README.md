# 자판기 미션 step2

- 마르코
- 데모페이지 : https://wonsss.github.io/javascript-vendingmachine

## 로컬에서 설치 및 실행 방법

1. 필수 npm package를 설치한다 : `npm install`
2. `.env` 파일을 `.env.example` 파일을 참고하여 만든다.
3. 프로젝트를 시작한다 : `npm run start`
4. UNIT 테스트를 시작한다 : `npm run test`
5. E2E 테스트를 시작한다 : `npm run cypress:open`

## step2 기능 구현 목록

- [x] 웹컴포넌츠를 이용하여 토스트 알림창 구현
  - [x] 사용자가 버튼을 클릭했을 때 해당 행위가 정상적으로 동작하거나, 실패하였음을 토스트 알림창(snackbar)를 통해 보여준다.
- [x] 존재하지 않는 url로 접근한 경우, 404 에러 알림을 표시한다.

### 1. 상품 구매탭

- [x] 상품구매탭 HTML, CSS 마크업 작성

#### 1-1. 금액 투입

- [x] 최초 투입된 금액은 0원이다.
- [x] 투입 금액을 입력하고 투입 버튼을 누르면, 금액이 투입된다.
  - [x] 투입 금액 유효성 검사
    - 금액은 10원으로 나누어 떨어지는 금액만 투입할 수 있다.
    - 최대 투입 금액은 10,000원이다.
  - [x] 금액은 누적으로 투입할 수 있다.

#### 1-2. 상품 구매

- [x] 투입한 금액에 맞춰 재고가 있는 상품을 구매할 수 있다.
- [x] 상품이 구매된 경우, 스낵바를 통해 알린다.
- [x] 재고가 없는 상품에 대해 구매 버튼을 누른 경우, 재고없음 상태를 스낵바를 통해 알린다.
- [x] 선택한 상품을 구입하기에 충분한 돈이 없는데도 구매 버튼을 누른 경우, 돈이 부족함을 스낵바를 통해 알린다.

#### 1-3. 잔돈 반환

- [x] 최초 반환된 각 동전의 개수는 0개이다.
- [x] 반환하기 버튼을 누르면 다음 규칙에 의거 잔돈을 반환 받을 수 있다.

  - [x] 잔돈을 돌려줄 때는 현재 보유한 최소 개수의 동전으로 잔돈을 돌려준다.(큰 금액의 동전부터 최대한 반환)
  - [x] 잔돈이 부족한 경우, 반환할 수 있는 금액만 반환한다.
  - [x] 반환하지 못한 금액이 있는 경우, 스낵바를 통해 알린다.

### 2. 회원가입

- [x] 회원가입 웹컴포넌트 작성(`<sign-up>`)

  - [x] CSS 스타일 추가
  - [x] 비밀번호 확인 검증 로직 추가

- [x] 관리자의 회원 가입을 위한 기능은 json-server-auth를 이용한다.
- [x] 회원정보 입력 후 회원가입 버튼을 클릭하면, 회원가입이 완료된다.
  - [x] 회원가입 유효성 검사
    - name은 2~6글자까지 가능하다.
    - password는 8자리에서 16자리 사이여야 하며, 영어, 숫자, 특수문자 각각 최소 1개 이상 조합이어야 한다.
    - 동일한 email로 중복 가입이 불가하다 .
  - [x] 회원가입에 실패할 경우 스낵바를 통해 알린다.

### 3. 로그인

- [x] 로그인 웹컴포넌트 작성(`<log-in>`)

  - [x] CSS 스타일 추가
  - [x] 회원가입 링크 클릭 시 회원가입 모달창 열기

- [x] 아이디와 비밀번호를 입력하고 로그인 버튼을 클릭하면, 로그인이 완료된다.
  - [x] 로그인 유효성 검사
    - 회원가입되어 있는 아이디이며 정확한 비밀번호임을 검증한다.
  - [x] 로그인에 실패할 경우 스낵바를 통해 알린다.

### 4. 회원정보 수정

- [x] 회원정보 수정 웹컴포넌트 작성(`<profile-edit>`)

  - [x] CSS 스타일 추가
  - [x] 회원정보 수정 기능으로 변경

- [x] 이메일은 수정할 수 없다.(disabled)
- [x] 이름 요소에 기존 이름이 적혀있다.
- [x] 회원정보 수정 버튼을 누르면, 회원정보 수정이 완료된다.
  - [x] 수정된 회원정보 유효성 검사
    - name은 2~6글자까지 가능하다.
    - password는 8자리에서 16자리 사이여야 하며, 영어, 숫자, 특수문자 각각 최소 1개 이상 조합이어야 한다.
    - password는 기존 password와 동일해야 한다.
  - [x] 회원정보 수정에 실패할 경우 스낵바를 통해 알린다.

### 5. 비로그인 유저의 화면(상품 구매 페이지, 관리자 로그인 버튼)

- [x] 비로그인 유저의 화면 HTML, CSS 마크업 수정

- [x] 로그인하지 않은 유저에게는 로그인 외 다른 관리 기능 버튼은 보이지 않는다.

### 6. 로그인 유저의 화면

- [x] 로그인 유저의 화면 HTML, CSS 마크업 수정

### 7. 유저 메뉴

- [x] 로그인 유저 웹컴포넌트 작성(`<user-menu>`)
  - [x] HTML, CSS 스타일 추가
  - [x] 비로그인 시, 로그인 버튼만 표시된다.
  - [x] 로그인하고 나면 로그인 버튼은 사라진다.
  - [x] 로그인한 유저의 이름 중 첫번째 글자를 썸네일처럼 만든다.
  - [x] 로그인한 유저의 썸네일을 클릭하면 select box로 `회원정보수정`과 `로그아웃` 메뉴가 표시된다.
- [x] 로그아웃 버튼을 누르면, 비로그인 유저의 화면이 표시된다.
- [x] 회원정보수정 버튼을 누르면, 회원정보수정 페이지가 표시된다.

### 리팩토링, 버그 수정

- [x] 컴포넌트에서 auth 및 render 로직 분리
- [x] 메뉴 버튼 열린 상태에서 바깥 부분 누르면 메뉴 닫기
- [x] 메뉴에서 버튼을 누르면 메뉴 닫기
- [x] 인증정보 관리를 Cookie로 변경(로그인 후 1시간 지나면 유효기간 만료)
- [x] 로그인 여부에 따라 접근 가능한 페이지만 렌더링하도록 수정 - 필요한 부분만 insertAdjacent하여 렌더링
- [x] 로그인과 회원가입은 url로 접근할 수 있도록 라우터 수정
  - 로그인 url : https://wonsss.github.io/javascript-vendingmachine/#!/login
  - 회원가입 url : https://wonsss.github.io/javascript-vendingmachine/#!/signup

### E2E테스트

- [x] 회원가입 및 로그인 테스트
- [x] 금액 투입, 상품 구매, 잔돈 반환 테스트
- [x] 상품 관리 테스트(상품추가, 상품수정, 상품삭제)
- [x] 잔돈 충전 테스트(동전 합 구하기, 표시된 보유 금액, 알림창)

## step1 기능 구현 목록

- 1. HTML,CSS 마크업 작성
  - [x] Nav 탭 마크업 작성
  - [x] 상품관리탭 HTML, CSS
  - [x] 잔돈충전탭 HTML, CSS
- 2. 탭 이동을 구현한다.
  - [x] URL로 접근했을 때에도 해당 탭으로 이동할 수 있어야 한다.
- 3. 상품관리탭에서 사용자 입력값 받기
  - [x] 상품명은 최대 10글자까지 가능
  - [x] 상품 가격은 100원부터 시작하며, 최대 10,000원까지 가능, 10의 배수여야 한다
  - [x] 한 제품당 수량은 최대 20개까지 가능
  - [x] 상품명이 같으면 alert를 표시하고 에러를 발생한다.
- 4. 유효한 상품입력값을 자판기에 추가한다.
  - [x] 이름이 중복되는 상품이 있으면 경고한 후 추가하지 않는다.
- 5. 추가한 상품을 화면에 표시
  - [x] 상품명, 가격, 수량, 수정버튼, 삭제버튼이 화면에 삽입된다.
- 6. 관리하고 있는 상품에 대해 수정 또는 삭제 할 수 있다.
  - [x] 삭제 버튼을 클릭하면, 해당 상품이 삭제된다.
  - [x] 삭제 시 confirm을 통해 사용자에게 확인을 받는다.
  - [x] 수정 버튼을 클릭하면, 상품명, 가격, 수량을 수정할 수 있다.
- 7. 잔돈충전탭에서 사용자 입력값 받아서 보유금액 화면에 표시한다.
  - [x] 금액은 10의 배수여야 한다.
  - [x] 보유할 수 있는 최대 금액은 100,000원이다.
  - [x] 현재 보유한 금액을 화면에 표시한다.
  - [x] 충전한 금액만큼의 동전을 무작위로 생성하여 기존 보유 동전에 추가한다.
- 9. [x] 동전의 개수를 화면에 표시한다.

## 리팩토링할 목록

- 로컬스토리지 적용하기
  - [x] 현재 탭 기억하기
  - [x] VendingMachine 데이터(괸리중 상품정보, 충전된 잔돈) 기억하기
- 사용성 개선
  - [x] form 제출 후 input 값 비우기
  - [x] 다른 탭으로 이동하면 해당 탭의 첫 번째 input에 focus하기
  - [x] 상품명에 공백 추가하여 입력할 경우, 중복으로 인지하지 못하던 이슈 해결(ex, "콜라" = "콜라 " 문제)
  - [x] 상품 수량 수정 시, 소수점 이하 값 입력되던 이슈 해결

## 요구사항 - 관리자 기능

- 1. 공통
  - 도메인 영역을 타입스크립트를 이용하여 구현한다.
  - Interface 또는 type을 이용하여, 주요 도메인 객체의 타입을 정의하고 설계한다.
- 2. 라우팅 기능

  - Browser History Api를 이용하여 SPA처럼 라우팅을 적용한다.
  - 매번 페이지를 로드 하는 것이 아닌, 히스토리를 관리하고, 페이지를 url에 따라 동적으로 렌더링한다
  - 상품 관리, 잔돈 충전, 상품 구매 페이지는 모두 동적으로 렌더링해야 한다.

- 3. 상품 관리 탭

  - 상품 관리탭은 자판기가 보유하고 있는 상품을 추가하는 기능을 수행한다.
  - 최초 상품 목록은 비워진 상태이다.
  - 상품명, 가격, 수량을 입력해 상품을 추가할 수 있다.
    - 상품명은 최대 10글자까지 가능하다.
    - 상품 가격은 100원부터 시작하며, 최대 10,000원까지 가능하다. 그리고 10원으로 나누어 떨어져야 한다.
    - 한 제품당 수량은 최대 20개까지 넣을 수있다.
  - 관리자는 추가한 상품을 확인할 수 있다.
  - 관리자는 추가한 상품을 수정, 삭제할 수 있다.
    - 수정 시 상품명, 가격, 수량 정보 영역 자체가 인풋 영역으로 변경된다.
    - 삭제 시 confirm을 활용하여 사용자에게 다시 한번 확인한다.

- 4. 잔돈 충전 탭

  - 잔돈 충전탭은 자판기가 보유할 금액을 충전하는 기능을 수행한다.
  - 잔돈 충전 탭에서 최초 자판기가 보유한 금액은 0원이며, 각 동전의 개수는 0개이다.
  - 잔돈 충전 입력 요소에 충전할 금액을 입력한 후, 충전하기 버튼을 눌러 자판기 보유 금액을 충전할 수 있다.
  - 잔돈은 10원으로 나누어 떨어지는 금액만 투입할 수 있다. 보유할 수 있는 최대 금액은 100,000원이다.
  - 자판기 보유 금액만큼의 동전이 무작위로 생성된다.
  - 자판기 보유 금액을 누적하여 충전할 수 있다. 추가 충전 금액만큼의 동전이 무작위로 생성되어 기존 동전들에 더해진다.

- 5. 테스트 요구사항
  - 비즈니스 로직에 대한 단위 테스트를 Jest로 작성한다.
